var currentController,youtubeFlag=!1;$(function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var t=window.innerWidth,i=$("#dyno"),r=$("body"),s=(document.getElementsByTagName("section"),0),a=!1;function n(e,t,n){var o=window.scrollX||document.documentElement.scrollLeft,i=e||0,r=t||2e3,s=n||"easeOutSine",a=0,l=Math.max(.1,Math.min(Math.abs(o-i)/r,1.2)),c={easeOutSine:function(e){return Math.sin(e*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e)-1)},easeInOutQuint:function(e){return(e/=.5)<1?.5*Math.pow(e,5):.5*(Math.pow(e-2,5)+2)}};!function e(){var t=(a+=1/60)/l,n=c[s](t);t<1?(requestAnimFrame(e),window.scrollTo(o+(i-o)*n,0)):window.scrollTo(i,0)}()}window.addEventListener("resize",function(){t=window.innerWidth,offsetX=window.pageXOffset}),document.onkeydown=function(e){var t=$(".prevSlide"),n=$(".nextSlide");if("37"==e.keyCode)t.click().focus();else if("39"==e.keyCode)n.click().focus();else{if("27"!=e.keyCode||!a)return;$("button#empty").click()}},$("#arrows button").on("click",function(e){e.preventDefault(),function(e){$("html, body");var t=$(".activeSection");n(e.classList.contains("prevSlide")?t.prev().length?t.prev().offset().left:0:t.next().length?t.next().offset().left:0,1500,"easeInOutSine"),setTimeout(function(){$(".activeSection").focus()},1e3)}(this)});var o=0,l=!1,c=document.getElementById("scrub"),d=document.getElementById("scrubCont"),u=d.offsetWidth-100,m=0,w=$("section").length-1,f=t*w;var g=0,v=!1;window.addEventListener("mousemove",function(e){g=e.clientX,v||window.requestAnimFrame(function(){var e;e=g,!0===l&&(c.style.left=Math.ceil((e<75?75:e)-(o-m))+"px",window.scrollTo(t*w/(d.offsetWidth/e),0)),v=!0}),v=!1}),d.addEventListener("mousedown",function(e){l=!0,e.pageX,o=e.clientX,m=c.offsetLeft}),window.addEventListener("mouseup",function(e){l=!1});var h=0;var e=null;window.addEventListener("scroll",function(){h=window.pageXOffset,l||window.requestAnimFrame(function(){var e;e=h,c.style.left=Math.ceil(e/f*u)+"px",0}),a||(clearTimeout(e),e=setTimeout(function(){n($(".activeSection").offset().left,600,"easeInOutQuint")},600))});var T=new ScrollMagic.Controller({vertical:!1}),x=(new TimelineMax).to("#slide1text",2,{x:"-100%",ease:Power0.easeInOut},0),p=(new TimelineMax).fromTo("#slide2text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025}),S=(new TimelineMax).fromTo("#slide3text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025}),y=(new TimelineMax).fromTo("#slide4text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025}),M=(new TimelineMax).fromTo("#slide5text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025}),k=(new TimelineMax).fromTo("#slide6text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025}),b=(new TimelineMax).fromTo("#slide7text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025});(new TimelineMax).fromTo("#slide8text",1,{x:"60%",scale:.75},{x:"0%",scale:1.025});$("#content-wrapper section").each(function(e,t){var n=new ScrollMagic.Scene({duration:"100%",triggerElement:this,triggerHook:.5});n.addTo(T),n.setClassToggle(this,"activeSection")});new ScrollMagic.Scene({duration:"100%",triggerElement:"body",triggerHook:0}).setClassToggle("body","hidePrev").setTween(x).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide2",triggerHook:.9}).setTween(p).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide3",triggerHook:.9}).setTween(S).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide4",triggerHook:.9}).setTween(y).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide5",triggerHook:.9}).setTween(M).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide6",triggerHook:.9}).setTween(k).addTo(T),new ScrollMagic.Scene({duration:"125%",triggerElement:"#slide7",triggerHook:.9}).setTween(b).addTo(T),new ScrollMagic.Scene({duration:"100%",triggerElement:"#slides section:last-child",triggerHook:.5}).setClassToggle("body","hideNext").addTo(T);function C(){if(0<window.scrollX){var e=Math.ceil(.02*window.scrollX);E.css({"-webkit-transform":"translate("+e+"px,0)"}),L.css({"-webkit-transform":"translate("+e+"px,0)"})}else window.scrollX<0?(E.css({"-webkit-transform":"translate(0px,0px)"}),L.css({"-webkit-transform":"translate(0px,0px)"})):window.scrollX;X=!0}if(scrollConverter.activate(),$(".story-link").on("click",function(e){var t=$(e.target),n=t.data("js")||"test",o=t.data("title")||"Immersive story";s=window.pageXOffset,a=!0,e.preventDefault(),r.addClass("loading"),history.pushState({page:o},o,e.target.href),i.load(e.target.href+" #immersive-body",function(){scrollConverter.deactivate(s),$("<link/>",{id:"dynamicCSS",rel:"stylesheet",type:"text/css",href:"/wp-content/themes/be-boundless/immersive-stories/css/"+n+".css"}).appendTo("head"),$.when($.getScript("/wp-content/themes/be-boundless/immersive-stories/js/"+n+".min.js"),$.Deferred(function(e){$(e.resolve)})).done(function(){setTimeout(function(){r.toggleClass("active-story loading")},500),setTimeout(function(){r.addClass("makeStatic")},1e3)})})}),isMobile.matches||$(".related h3").on("click",function(e){$(e.target).parent().parent().toggleClass("related-active")}),$("button#empty").on("click",function(e){a=!1,e.preventDefault(),r.removeClass("makeStatic"),currentController.destroy(),setTimeout(function(){i.empty(),$("#dynamicCSS").remove(),userClosedMenu||isMobile.matches,scrollConverter.activate(s)},500),history.back(),void 0!==document.body.scrollLeft&&(document.body.scrollLeft=s),void 0!==document.documentElement.scrollLeft&&(document.documentElement.scrollLeft=s),r.removeClass("active-story")}),$("body").toggleClass("pageLoaded"),320===window.screen.width&&568===window.screen.height&&navigator.userAgent.match(/iPhone/i)){var E=$("#campaign-header"),L=$("#arrows"),X=(window.scrollX,!0);E.width(t),L.width(t),document.addEventListener("resize",function(){E.width(t),L.width(t)}),document.addEventListener("scroll",function(){X&&(window.requestAnimFrame(C),X=!1)})}});